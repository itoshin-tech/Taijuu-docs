# CSVファイルフォーマット仕様

体重管理アプリのデータエクスポート/インポートで使用するCSVファイルのフォーマット仕様です。

## ファイル構造

CSVファイルは以下の構造で構成されます：

```csv
# SETTINGS: {設定情報のJSON}
# EVENTS: {イベントマップのJSON}
datetime,weight,memo,event_ids
2026-02-07T12:00:00.000,55.0,,
2026-02-08T12:00:00.000,50.0,,1,2
...
```

## ヘッダー行

### 1. SETTINGS行（グラフ設定）

**フォーマット:**
```
# SETTINGS: {"yAxisMode":"<mode>","minWeight":<number>,"maxWeight":<number>,"minTargetWeight":<number>,"maxTargetWeight":<number>}
```

**パラメータ:**

| パラメータ | 型 | 説明 | 有効な値 |
|-----------|-----|------|---------|
| `yAxisMode` | string | Y軸の表示モード | `"visible"` (表示範囲), `"all"` (全データ), `"fixed"` (固定範囲) |
| `minWeight` | number | 固定範囲の最小体重 (kg) | 数値 (例: 50.0) |
| `maxWeight` | number | 固定範囲の最大体重 (kg) | 数値 (例: 80.0) |
| `minTargetWeight` | number | 目標体重の下限 (kg) | 数値 (例: 60.0) |
| `maxTargetWeight` | number | 目標体重の上限 (kg) | 数値 (例: 70.0) |

**例:**
```json
{"yAxisMode":"all","minWeight":50.0,"maxWeight":80.0,"minTargetWeight":60.0,"maxTargetWeight":70.0}
```

### 2. EVENTS行（イベントマップ）

**フォーマット:**
```
# EVENTS: {"<id>":{"label":"<ラベル>","emoji":"<絵文字>"},...}
```

**パラメータ:**

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| `id` | number | イベントID（キー） |
| `label` | string | イベントのラベル名 |
| `emoji` | string | 表示する絵文字 |

**例:**
```json
{"1":{"label":"食べすぎ","emoji":"🥖"},"2":{"label":"ダイエット","emoji":"❤️"},"3":{"label":"お腹","emoji":"🖤"}}
```

## データ行

### CSVヘッダー
```
datetime,weight,memo,event_ids
```

### データ列

| 列名 | 型 | 説明 | 例 |
|------|-----|------|-----|
| `datetime` | ISO 8601 | 記録日時 | `2026-02-07T12:00:00.000` または `2026-02-07 00:00:00` |
| `weight` | number | 体重 (kg) | `55.0`, `74.4` |
| `memo` | string | メモ（空の場合は空文字列 `""`） | `"菓子パン"`, `"夜6時以降食べなかった"`, `""` |
| `event_ids` | string | イベントIDのカンマ区切りリスト（空の場合は空文字列 `""`） | `"1"`, `"3,2"`, `""` |

**event_idsの例:**
- 単一イベント: `"1"`, `"2"`, `"3"`
- 複数イベント: `"1,2"`, `"3,2"`, `"2,3"`（カンマ区切り、スペースなし）
- イベントなし: `""`（空文字列）

## サンプルファイル

完全なサンプルファイルは `data/sample.csv` を参照してください。

以下は実際のデータを含むサンプルの抜粋です：

```csv
# SETTINGS: {"yAxisMode":"all","minWeight":50.0,"maxWeight":80.0,"minTargetWeight":60.0,"maxTargetWeight":70.0}
# EVENTS: {"1":{"label":"食べすぎ","emoji":"🥖"},"2":{"label":"ダイエット","emoji":"❤️"},"3":{"label":"お腹","emoji":"🖤"}}
datetime,weight,memo,event_ids
2026-02-06 00:00:00,74.4,"",""
2026-02-05 00:00:00,74.2,"",""
2026-02-04 00:00:00,74.4,"","2"
2026-02-03 00:00:00,74.7,"","3,2"
2026-02-02 00:00:00,75.5,"菓子パン","3,2"
2026-02-01 00:00:00,74.0,"","1"
2026-01-31 00:00:00,74.0,"","1"
2026-01-30 00:00:00,74.1,"","2"
2026-01-29 00:00:00,74.2,"","2"
2026-01-28 00:00:00,74.9,"サルサ","3,2"
2026-01-27 00:00:00,75.0,"","2"
2026-01-26 00:00:00,76.0,"夜6時以降食べなかった","2,3"
...
```

**データの特徴:**
- **メモあり**: `"菓子パン"`, `"サルサ"`, `"夜6時以降食べなかった"` など具体的な記録
- **メモなし**: 空文字列 `""` で表現
- **イベント単数**: `"1"`, `"2"`, `"3"` など単一のイベントID
- **イベント複数**: `"3,2"`, `"2,3"` などカンマ区切りで複数のイベントID
- **イベントなし**: 空文字列 `""` で表現

## インポート時の動作

1. **SETTINGS行**: グラフ設定として読み込まれ、`SettingsService`に保存されます
2. **EVENTS行**: イベントマップとして読み込まれ、アプリ内で使用されます
3. **データ行**: 体重記録として読み込まれます

## 注意事項

- ヘッダー行（`# SETTINGS:`と`# EVENTS:`）は省略可能です
- 省略した場合、デフォルト値が使用されます
- JSON形式は厳密に従う必要があります（ダブルクォート必須）
- 日時はISO 8601形式を推奨しますが、他の形式でも解析を試みます
